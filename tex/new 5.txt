\subsection{Цель эксперимента}


Целью эксперимента является попытка оптимизировать алгоритм обратной трассировки лучей для данной сцены. 

Необходимо провести теоретическое сравнение оптимизированного и неоптимизированного алгоритма, а также подтвердить результаты на практике путем подсчета колличесва испускаемых лучей для построения сцены.

Эксперимент будет проводиться на различных сценах, с разным количесвом этажей, а также с разными видами молнии.

\begin{enumerate}
	\item Количество этажей -- 6, молния без побочных ветвей бьет в громоотвод, количество окон, в которых горит цвет -- не имеет значения.
	\item Количество этажей -- максимальное, молния-лидер с большим количеством ветвей бьет в земплю, во всех окнах не горит свет.
	\item Количество этажей -- минимальное, молния без ветвей бьет в громоотвод, во всех окнах горит свет. 
	\item Количество этажей -- 5, молния-лидер бьет в землю, количество окон, в которых горит свет -- не имеет значение.
	\item Количество этажей -- макисмальное, молния-лидер бьет в землю, во всех окнах горит свет.
\end{enumerate}


\section {Преобразования}

\subsection {Некоторые теоретические сведения}

Преобразования на плоскости - изменение значений точек на плоскости:

\begin{equation}
	A(x,y)\rightarrow B(x_1,y_1)
\end{equation}

Линейное преобразование:

\begin{equation}
	{\begin{cases}
			x_1 = Ax + By + C \\
			y_1 = Dx + Ey + F \\
	\end{cases}}
\end{equation}

Однородные координаты:

\begin{equation}
	(x, y, w),
\end{equation}
где w - масштабный множитель (для плоского случая w = 1), в обратном случае:

\begin{equation}
	{\begin{cases}
			x' = x / w  \\
			y' = y / w. \\
	\end{cases}}
\end{equation}

Матрица преобразований:

\begin{equation}
	Mtr = \left(
	\begin{array}{cccc}
		A & D & 0 \\
		B & E & 0 \\
		C & F & 1 \\
	\end{array}
	\right)
\end{equation}

Тогда, используя однородные координаты и матрицу преобразования, можно получить результат преобразования:

\begin{equation}
	(x_1, y_1, 1) = (x, y, 1) * Mtr
\end{equation}

Методы двумерных преобразований распространяются и на изображения трехмерных объектов.
Матрица преобразований  в трехмерном пространстве  в однородных координатах будет иметь размерность 4*4,
а точки (x, y, z)
заменяются четверткой (xw, yw, zw, w), w отлично от 0

\subsection {Перенос}

Для переноса потребуется два параметра: dx - смещение по оси абсцисс и dy - смещение по оси ординат.

\begin{equation}
	{\begin{cases}
			x_1 = x + dx \\
			y_1 = y + dy \\
	\end{cases}}
\end{equation}

Матрица переноса в двухмерном пространстве:

\begin{equation}
	Mmove = \left(
	\begin{array}{cccc}
		1  & 0  & 0 \\
		0  & 1  & 0 \\
		dx & dy & 1 \\
	\end{array}
	\right)
\end{equation}

Матрица переноса в трехмерном пространстве:

\begin{equation}
	Mmove = \left(
	\begin{array}{cccc}
		1  & 0  & 0  & 0 \\
		0  & 1  & 0  & 0 \\
		0  & 0  & 1  & 0 \\
		dx & dy & dz & 1 \\
	\end{array}
	\right)
\end{equation}

\subsection {Масштабирование}

Масштабирование - изменение размера. Задается коэффициентами масштабирования kx, ky и центром масштабирования xm, ym. Иллюстрация представлена на рисунке \ref{fig:ref1} \\
\begin{figure}[ht!]
	\centering{
		\includegraphics[width=0.6\textwidth]{img/move.jpg}
		\caption{Перемещение точки}
		\label{fig:ref1}}
\end{figure}

При $kx = ky$ масштабирование однородное.\\
При $kx\neq ky$ масштабирование неоднородное.\\
Отражение относительно OY: $kx = -1, ky = 1$.\\
Отражение относительно OX: $kx = 1, ky = -1$.\\
Отражение относительно начала координат: $kx = -1, ky = -1$.\\
Если коэффициент масштабирования больше 1, то изображение удаляется от центра и увеличивается.\\
Если коэффициент масштабирование меньше 1, то изображение приближается к центру и уменьшается.\\

Из Рис. \ref{fig:ref1} получаем:

\begin{equation}
	{\begin{cases}
			x_1 - x_m = kx(x - x_m) \\
			y_1 - y_m = ky(y - y_m)
			\label{eq:ref4}
	\end{cases}}
\end{equation}

Упростим (\ref{eq:ref4}) и получим:

\begin{equation}
	{\begin{cases}
			x_1 = kx * x + (1 - kx) * x_m \\
			y_1 = ky * y + (1 - ky) * y_m \\
	\end{cases}}
\end{equation}

Матрица масштабирования в двухмерном пространстве:

\begin{equation}
	Mscale = \left(
	\begin{array}{cccc}
		kx & 0  & 0 \\
		0  & ky & 0 \\
		0  & 0  & 1 \\
	\end{array}
	\right)
\end{equation}

Матрица масштабирования в трехмерном пространстве (добавляется коэффициент масштабирования: kz):

\begin{equation}
	Mscale = \left(
	\begin{array}{cccc}
		kx & 0  & 0  & 0 \\
		0  & ky & 0  & 0 \\
		0  & 0  & kz & 0 \\
		0  & 0  & 0  & 1 \\
	\end{array}
	\right)
\end{equation}

\subsection {Поворот}

Для поворота потребуется угол  $\theta$ и центр C(xc, yc) (рис. \ref{fig:ref2}).
\begin{figure}[ht!]
	\centering{
		\includegraphics[width=0.6\textwidth]{img/rotate.jpg}
		\caption{Поворот точки}
		\label{fig:ref2}}
\end{figure}

Поворот против часовой стрелки:
\begin{multline}
	\\
	x_1 = x_c + R*cos(180^{\circ}-(\varphi +  \theta)) = \\
	x_c - (x_c - x)cos(\theta) + (y - y_c)sin(\theta) = \\
	x_c + (x - x_c)cos(\theta) + (y - y_c)sin(\theta) \\
\end{multline}

\begin{multline}
	\\y_1 = y_c + R*sin(180^{\circ}-(\varphi +  \theta)) = \\
	y_c + (y - y_c)cos(\theta) + (x_c- x)sin(\theta) = \\
	y_c + (y - y_c)cos(\theta) - (x - x_c)sin(\theta) \\
\end{multline}

Матрица поворота против часовой стрелки в двухмерном пространстве:

\begin{equation}
	Mrotate = \left(
	\begin{array}{cccc}
		cos(\theta) & -sin(\theta) & 0 \\
		sin(\theta) & cos(\theta)  & 0 \\
		0           & 0            & 1 \\
	\end{array}
	\right)
\end{equation}

Матрица поворота в трехмерном пространстве вокруг оси Z :

\begin{equation}
	Mrotate = \left(
	\begin{array}{cccc}
		cos(\theta) & -sin(\theta) & 0 & 0 \\
		sin(\theta) & cos(\theta)  & 0 & 0 \\
		0           & 0            & 1 & 0 \\
		0           & 0            & 0 & 1 \\
	\end{array}
	\right)
\end{equation}
